# Chimera Log Rotation Configuration
# Install: sudo cp logrotate.conf /etc/logrotate.d/chimera
#
# Rotates:
# - Operator logs (JSON structured logs)
# - Backup logs
# - Reconciliation logs

# Main operator log
/var/log/chimera/operator.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0640 chimera chimera
    dateext
    dateformat -%Y%m%d
    
    # Signal systemd to reopen log files
    postrotate
        systemctl kill -s HUP chimera.service 2>/dev/null || true
    endscript
}

# Backup script logs
/var/log/chimera/backup.log {
    weekly
    rotate 8
    compress
    delaycompress
    missingok
    notifempty
    create 0640 chimera chimera
    dateext
}

# Reconciliation logs
/var/log/chimera/reconcile.log {
    weekly
    rotate 8
    compress
    delaycompress
    missingok
    notifempty
    create 0640 chimera chimera
    dateext
}

# Scout (Python) logs
/var/log/chimera/scout.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 chimera chimera
    dateext
}

# All other chimera logs (catch-all)
/var/log/chimera/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 chimera chimera
    sharedscripts
    dateext
    
    postrotate
        systemctl kill -s HUP chimera.service 2>/dev/null || true
    endscript
}
